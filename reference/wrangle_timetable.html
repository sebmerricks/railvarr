<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="A wrapper for timetable processing functions filter_relevant_services(),
filter_relevant_direction(), and find_calling_patterns()."><title>Wrangle Timetable Data — wrangle_timetable • railvarr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Wrangle Timetable Data — wrangle_timetable"><meta property="og:description" content="A wrapper for timetable processing functions filter_relevant_services(),
filter_relevant_direction(), and find_calling_patterns()."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">railvarr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9003</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/railvarr.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/sebmerricks/railvarr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Wrangle Timetable Data</h1>
      <small class="dont-index">Source: <a href="https://github.com/sebmerricks/railvarr/blob/HEAD/R/timetable.R" class="external-link"><code>R/timetable.R</code></a></small>
      <div class="d-none name"><code>wrangle_timetable.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A wrapper for timetable processing functions <code><a href="filter_relevant_services.html">filter_relevant_services()</a></code>,
<code><a href="filter_relevant_services.html">filter_relevant_direction()</a></code>, and <code><a href="find_calling_patterns.html">find_calling_patterns()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">wrangle_timetable</span><span class="op">(</span><span class="va">timetable</span>, <span class="va">stations</span>, <span class="va">stopping_stations</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>timetable</dt>
<dd><p>Data frame containing timetable data. Strict input validation
is performed. Must be a data frame with the following columns:</p><ul><li><p><code>train_header</code><code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code> Train identifier</p></li>
<li><p><code>dt_origin</code><code><a href="https://lubridate.tidyverse.org/reference/posix_utils.html" class="external-link">lubridate::POSIXct()</a></code> Datetime at which the train
originated</p></li>
<li><p><code>geo</code><code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code> Name of event location</p></li>
<li><p><code>event</code><code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code> Type of event, must only contain the
following values: <code>Pass</code>, <code>Arrive</code>, <code>Depart</code>, <code>Originate</code>,
<code>Terminate</code></p></li>
<li><p><code>wtt</code><code><a href="https://lubridate.tidyverse.org/reference/posix_utils.html" class="external-link">lubridate::POSIXct()</a></code> Scheduled datetime of event</p></li>
<li><p><code>t</code><code><a href="https://lubridate.tidyverse.org/reference/posix_utils.html" class="external-link">lubridate::POSIXct()</a></code> Actual datetime of event</p></li>
<li><p><code>delay</code><code><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric()</a></code> Difference between actual time and scheduled
time of event</p></li>
<li><p><code>allow</code><code><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric()</a></code> Timetabled delay allowance</p></li>
</ul></dd>


<dt>stations</dt>
<dd><p>You should provide a list of stations that you are interested
in. For example, a train may stop at many stations on its journey, but your
Centrix data only covers a small subset of that journey. Any trains which do
not pass through any of the stations specified will be discarded. It is
important to note that timetables do not only include station stops, they
also include junctions and other <code>'Pass'</code> events. These locations must also
be included in <code>stations</code>, even though they are not actually stations.</p>
<p>Therefore, your list should completely encompasses your Centrix data. This
ensures that all relevant services are included in the processed timetable.
However, you may need to ensure that no irrelevant services are accidentally
included.</p>
<p>The order in which you define this list is important if you are using
<code>wrangle_timetable()</code> or <code><a href="filter_relevant_services.html">filter_relevant_direction()</a></code>, because it specifies
the direction in which trains should be travelling. This allows for the
filtering of services by direction. You can avoid this by using the lower
level functions directly and not using <code><a href="filter_relevant_services.html">filter_relevant_direction()</a></code>, but
these functions do not currently come with input validation, so discretion
is advised.</p></dd>


<dt>stopping_stations</dt>
<dd><p>A subset of <code>stations</code> that specifies which stations
trains can stop at. This is used for calculating calling patterns.
Therefore, any train which does not stop at any of the stations specified in
<code>stopping_stations</code> will be labeled as a 'fast' train. Trains which do stop
at these stations will be labeled with 'stopping-', with the specific
stations at which they stop attached as suffixes. For example, if a train
stops at 'geo10', its calling pattern will be labeled as 'stopping-geo10'.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A subset of the timetable which contains trains that pass through the
specified stations in the given order. Time zone is set to "UTC".</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="filter_relevant_services.html">filter_relevant_services()</a></code> <code><a href="find_calling_patterns.html">find_calling_patterns()</a></code>
<code><a href="calculate_journey_specifications.html">calculate_journey_specifications()</a></code> <code><a href="match_ids.html">match_ids()</a></code> <a href="timetable.html">timetable</a>
<a href="timetable_subset.html">timetable_subset</a></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">timetable</span>, <span class="va">stations</span>, <span class="va">stopping_stations</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">timetable</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 8,958 × 11</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    train_header dt_origin           geo    event     wtt                </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> 168H         2000-01-01 <span style="color: #949494;">12:05:00</span> geo1   Originate 2000-01-01 <span style="color: #949494;">12:20:00</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> 168H         2000-01-01 <span style="color: #949494;">12:05:00</span> geo18  Arrive    2000-01-01 <span style="color: #949494;">12:23:00</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> 168H         2000-01-01 <span style="color: #949494;">12:05:00</span> geo18  Depart    2000-01-01 <span style="color: #949494;">12:24:00</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> 168H         2000-01-01 <span style="color: #949494;">12:05:00</span> geo2   Arrive    2000-01-01 <span style="color: #949494;">12:28:00</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> 168H         2000-01-01 <span style="color: #949494;">12:05:00</span> geo2   Depart    2000-01-01 <span style="color: #949494;">12:29:00</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> 168H         2000-01-01 <span style="color: #949494;">12:05:00</span> geo3   Arrive    2000-01-01 <span style="color: #949494;">12:35:30</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> 168H         2000-01-01 <span style="color: #949494;">12:05:00</span> geo3   Depart    2000-01-01 <span style="color: #949494;">12:36:30</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> 168H         2000-01-01 <span style="color: #949494;">12:05:00</span> geo104 Arrive    2000-01-01 <span style="color: #949494;">12:39:00</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> 168H         2000-01-01 <span style="color: #949494;">12:05:00</span> geo104 Depart    2000-01-01 <span style="color: #949494;">12:39:30</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> 168H         2000-01-01 <span style="color: #949494;">12:05:00</span> geo4   Arrive    2000-01-01 <span style="color: #949494;">12:41:30</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 8,948 more rows</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 6 more variables: t &lt;dttm&gt;, delay &lt;dbl&gt;, allow &lt;dbl&gt;, allow_perf &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   allow_path &lt;dbl&gt;, allow_eng &lt;dbl&gt;</span></span>
<span class="r-in"><span><span class="va">timetable_subset</span> <span class="op">&lt;-</span> <span class="fu">wrangle_timetable</span><span class="op">(</span><span class="va">timetable</span>, <span class="va">stations</span>, <span class="va">stopping_stations</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">timetable_subset</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 792 × 12</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    train_header dt_origin           geo    event  wtt                </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> 108H         2000-01-01 <span style="color: #949494;">12:55:00</span> geo5   Arrive 2000-01-01 <span style="color: #949494;">13:34:00</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> 108H         2000-01-01 <span style="color: #949494;">12:55:00</span> geo5   Depart 2000-01-01 <span style="color: #949494;">13:35:30</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> 108H         2000-01-01 <span style="color: #949494;">12:55:00</span> geo6   Pass   2000-01-01 <span style="color: #949494;">13:37:30</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> 108H         2000-01-01 <span style="color: #949494;">12:55:00</span> geo110 Arrive 2000-01-01 <span style="color: #949494;">13:39:00</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> 108H         2000-01-01 <span style="color: #949494;">12:55:00</span> geo110 Depart 2000-01-01 <span style="color: #949494;">13:39:30</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> 108H         2000-01-01 <span style="color: #949494;">12:55:00</span> geo111 Arrive 2000-01-01 <span style="color: #949494;">13:42:00</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> 108H         2000-01-01 <span style="color: #949494;">12:55:00</span> geo111 Depart 2000-01-01 <span style="color: #949494;">13:42:30</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> 108H         2000-01-01 <span style="color: #949494;">12:55:00</span> geo112 Arrive 2000-01-01 <span style="color: #949494;">13:44:30</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> 108H         2000-01-01 <span style="color: #949494;">12:55:00</span> geo112 Depart 2000-01-01 <span style="color: #949494;">13:45:00</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> 108H         2000-01-01 <span style="color: #949494;">12:55:00</span> geo7   Arrive 2000-01-01 <span style="color: #949494;">13:48:00</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 782 more rows</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 7 more variables: t &lt;dttm&gt;, delay &lt;dbl&gt;, allow &lt;dbl&gt;, allow_perf &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   allow_path &lt;dbl&gt;, allow_eng &lt;dbl&gt;, group &lt;chr&gt;</span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Sebastian Merricks.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

