<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Calculates a set of time intervals containing valid Centrix observations.
These observations correspond to distinct / interlaced train journeys."><title>Calculate train journey intervals — calculate_time_windows • railvarr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate train journey intervals — calculate_time_windows"><meta property="og:description" content="Calculates a set of time intervals containing valid Centrix observations.
These observations correspond to distinct / interlaced train journeys."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">railvarr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9002</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/railvarr.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/sebmerricks/railvarr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Calculate train journey intervals</h1>
      <small class="dont-index">Source: <a href="https://github.com/sebmerricks/railvarr/blob/HEAD/R/centrix-windows.R" class="external-link"><code>R/centrix-windows.R</code></a></small>
      <div class="d-none name"><code>calculate_time_windows.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculates a set of time intervals containing valid Centrix observations.
These observations correspond to distinct / interlaced train journeys.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calculate_time_windows</span><span class="op">(</span><span class="va">aspect_events</span>, <span class="va">track_events</span>, <span class="va">asset_map</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>aspect_events</dt>
<dd><p>A data frame containing pre-processed aspect events with
columns:</p><ul><li><p><code>signal</code> <code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code> signal ID.</p></li>
<li><p><code>dt</code> <code><a href="https://lubridate.tidyverse.org/reference/posix_utils.html" class="external-link">lubridate::POSIXct()</a></code> datetime.</p></li>
<li><p><code>aspect</code> <code><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor()</a></code> signal aspect after train enters the signal
section.</p></li>
<li><p><code>past_aspect</code> <code><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor()</a></code> signal aspect before train enters the
signal section.</p></li>
</ul></dd>


<dt>track_events</dt>
<dd><p>A data frame containing pre-processed track events with
columns:</p><ul><li><p><code>track</code> <code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code> track ID.</p></li>
<li><p><code>dt</code> <code><a href="https://lubridate.tidyverse.org/reference/posix_utils.html" class="external-link">lubridate::POSIXct()</a></code> datetime.</p></li>
<li><p><code>occcupied</code> <code><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical()</a></code> TRUE if train enters track, else FALSE.</p></li>
<li><p><code>event</code> <code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code> 'enters' if train enters track, else
'vacates'.</p></li>
</ul></dd>


<dt>asset_map</dt>
<dd><p>A data frame containing a 1-1 mapping from signals to berths
and a 1-many mapping from berths to tracks. The map also contains a 1-many
mapping from tracks to events, reflecting the fact that there is an 'enter'
and a 'vacate' event for each track. Therefore, the data frame should
adhere to the following structure:</p><ul><li><p><code>signal</code>: A <code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code> vector containing the signal ID. It
should follow the regex pattern <code>"S[0-9]+"</code>.</p></li>
<li><p><code>berth</code>: A <code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code> vector containing the berth ID. It
should follow the regex pattern <code>"[A-Z]+"</code>.</p></li>
<li><p><code>track</code>: A <code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code> vector containing the track ID. It
should follow the regex pattern <code>"T[A-Z]+(-[0-9])?"</code>.</p></li>
<li><p><code>event</code>: A <code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code> vector containing the event type. It
must be one of either "enters" or "vacates".</p></li>
</ul></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A data frame containing window IDs and time intervals in the
columns:</p><ul><li><p><code>window</code> <code><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric()</a></code> window ID.</p></li>
<li><p><code>interval</code> <code><a href="https://lubridate.tidyverse.org/reference/interval.html" class="external-link">lubridate::interval()</a></code> time intervals.</p></li>
</ul><p>Each window indicates a time interval in which the data contain valid
observations.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>A train journey across the track section begins as the train enters
the first track specified in the <code>asset_map</code> and ends when the train
vacates the last. If the next train to pass through is sufficiently far
behind, there will be some period of time where the track is empty -
between the first train leaving the last track and the next train entering
the first track. Therefore, any events that occur in this time are invalid
and are discarded.</p>
<p>The time windows that this function identifies are the inverse of the
previous intervals, defining the time periods that trains are present in
the track section. The events within these windows are validated by the
number of signals/tracks, the number of events, and the number of trains.
Only valid journeys are returned, which can result in data loss of around
1%.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="preprocess_signal_events.html">preprocess_signal_events()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">aspect_events</span>, <span class="va">track_events</span>, <span class="va">asset_map</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">time_windows</span> <span class="op">&lt;-</span> <span class="fu">calculate_time_windows</span><span class="op">(</span><span class="va">aspect_events</span>,</span></span>
<span class="r-in"><span>                                       <span class="va">track_events</span>,</span></span>
<span class="r-in"><span>                                       <span class="va">asset_map</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">time_windows</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 681 × 2</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    window interval                                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;Interval&gt;</span>                                      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>      2 2000-01-01 13:07:11 UTC--2000-01-01 13:21:32 UTC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>      3 2000-01-01 13:22:09 UTC--2000-01-01 13:26:10 UTC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>      4 2000-01-01 13:27:43 UTC--2000-01-01 13:32:27 UTC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>      7 2000-01-01 14:07:06 UTC--2000-01-01 14:20:32 UTC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>      8 2000-01-01 14:26:30 UTC--2000-01-01 14:33:18 UTC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>      9 2000-01-01 14:34:54 UTC--2000-01-01 14:54:57 UTC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>     10 2000-01-01 15:06:54 UTC--2000-01-01 15:20:53 UTC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>     11 2000-01-01 15:37:57 UTC--2000-01-01 15:50:21 UTC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>     12 2000-01-01 16:07:15 UTC--2000-01-01 16:17:10 UTC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>     13 2000-01-01 16:37:04 UTC--2000-01-01 16:49:11 UTC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 671 more rows</span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Sebastian Merricks.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

